# 修复数据保存报错与文件路径优化方案

本方案将解决保存世界卡时的 `DataCloneError` 崩溃问题，并优化 JSON 文件的持久化路径，确保开发环境下的数据唯一性。

## 1. 修复 DataCloneError (world.ts)
*   **问题原因**：Vue 3 的响应式对象（Proxy）无法直接通过 IndexedDB 的结构化克隆算法。
*   **对策**：在 [world.ts](file:///d:/Education/Project/Faramita%20Worlds/src/renderer/store/world.ts) 的 `updateCard` 方法中，对传入的 `card` 对象执行深拷贝（使用 `JSON.parse(JSON.stringify(card))`），确保写入数据库的是纯粹的 JS 对象。

## 2. 优化文件保存路径 (main/index.ts)
*   **路径校验**：确保 [index.ts](file:///d:/Education/Project/Faramita%20Worlds/src/main/index.ts) 中的写入路径准确指向 `src/world_template/Oort.json`。
*   **动态定位**：使用 `app.getAppPath()` 或 `process.cwd()` 结合开发环境判断，增强路径定位的健壮性，确保在不同开发环境下都能准确找到源码目录下的模板文件。

## 3. 增强数据一致性
*   **唯一性保证**：在 [importer.ts](file:///d:/Education/Project/Faramita%20Worlds/src/renderer/db/importer.ts) 中增加逻辑说明，明确 IndexedDB 作为运行时数据源，而 `Oort.json` 作为源码模板。
*   **反馈优化**：在保存失败时提供更详细的错误堆栈捕获，方便后续排查。

**确认后，我将立即实施这些修复，解决您的保存报错问题。**