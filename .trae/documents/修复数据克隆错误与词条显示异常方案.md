# 修复 DataCloneError 与秘密词条显示异常方案

本方案将解决保存时的克隆错误，并纠正秘密词条 `(?)` 的显示逻辑。

## 1. 深度修复 DataCloneError (world.ts)
*   **问题**：虽然之前使用了 `JSON.parse(JSON.stringify())`，但在复杂嵌套对象中，Vue 的响应式代理或某些不可序列化属性可能依然存在，导致 IndexedDB `put` 操作失败。
*   **对策**：在 [world.ts](file:///d:/Education/Project/Faramita%20Worlds/src/renderer/store/world.ts) 中引入 Vue 的 `toRaw` 方法，结合深拷贝逻辑，确保传给数据库的是最原始的纯净数据。同时增加对 `addCard` 的同步修复。

## 2. 秘密词条显示逻辑纠正 (ActiveCodex.vue)
*   **问题**：`(?)至高神性` 被错误显示为 `至高神性(?)`，且未被正确过滤。这通常是因为过滤函数仅检查了开头，且可能存在字符编码或空格干扰。
*   **对策**：
    *   在 [ActiveCodex.vue](file:///d:/Education/Project/Faramita%20Worlds/src/renderer/components/ActiveCodex.vue) 中优化 `filterSecretEntries`：
        *   改用 `includes('(?)')` 进行全量过滤，确保无论 `(?)` 在前在后都能被识别并隐藏。
        *   增加对全角括号 `（？）` 的兼容支持。
    *   排查渲染层是否存在对词条的额外格式化逻辑。

## 3. 编辑器稳定性增强 (CardEditor.vue)
*   **对策**：在 [CardEditor.vue](file:///d:/Education/Project/Faramita%20Worlds/src/renderer/components/CardEditor.vue) 的保存逻辑中增加一次 `toRaw` 处理，确保发出的 `emit` 数据不带任何代理。

**确认后，我将立即执行修复，确保您的数据保存顺畅且秘密信息正确隐藏。**