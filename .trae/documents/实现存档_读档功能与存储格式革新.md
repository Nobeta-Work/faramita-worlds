# 存档与读档功能实现计划

为了实现完整的存档/读档功能并革新世界卡的存储形式，我们将把原本仅包含“设定”的世界卡升级为包含“设定+对话上下文”的完整“世界档案”。

## 1. 革新存储格式
- **升级数据结构**：在保存世界卡（JSON 文件）时，除了原本的 `world_meta` 和 `entries`（各种设定卡），还将包含 `chronicle`（对话历史上下文）。
- **统一性**：这意味着每一个导出的 JSON 文件都是一个完整的跑团现场快照，包含了所有的设定、角色状态以及对话进度。

## 2. 后端 (Electron) 接口扩展
- **新增文件对话框接口**：在主进程中新增 `show-save-dialog` 和 `show-open-dialog` 处理器，允许用户选择任意位置保存或读取 `.json` 格式的档案文件。
- **预加载脚本更新**：将这些新功能暴露给前端渲染进程。

## 3. 状态管理 (Store) 增强
- **世界卡 Store (`world.ts`)**：
    - 修改 `saveToFile`：在生成 JSON 字符串时，从数据库中提取完整的对话历史并整合进 JSON。
    - 新增 `loadArchive`：接收档案数据，执行数据库清理 (`clearAll`) 并重新灌入设定和对话历史。
- **编年史 Store (`chronicle.ts`)**：增加对历史记录的清空和重载支持。

## 4. 前端 UI 优化
- **左侧导航栏更新 (`App.vue`)**：
    - 在现有的“跑团”和“管理”图标下方，新增 **“存档” (Save)** 和 **“读档” (FolderOpen)** 图标。
    - **存档操作**：触发文件保存对话框，将当前完整的世界档案导出。
    - **读档操作**：触发文件打开对话框，读取档案并即时切换当前的所有游戏状态。

## 5. 初始导入逻辑升级
- **同步器 (`importer.ts`)**：升级初始化逻辑，使其在加载 `Oort.json` 或用户导入的档案时，能够识别并恢复其中的对话上下文。

此方案将使您的项目拥有真正意义上的“多档并行”能力，您可以随时保存当前剧情进度并在之后恢复。
