# 修复世界卡显示错误与代码异常方案

当前问题是由于 `Oort.json` 模板中部分条目缺失 `visible` 属性，导致前端 `EntityViewer.vue` 在进行可见性过滤时直接崩溃，进而导致界面显示为空白。

## 1. 核心修复步骤

### 增强代码鲁棒性
*   **修改 [EntityViewer.vue](file:///d:/Education/Project/Faramita%20Worlds/src/renderer/components/EntityViewer.vue)**：在过滤逻辑中使用可选链 (`?.`)，并为缺失可见性定义的卡片提供默认行为（默认为可见），防止组件崩溃。

### 规范数据导入逻辑
*   **修改 [importer.ts](file:///d:/Education/Project/Faramita%20Worlds/src/renderer/db/importer.ts)**：在将卡片导入数据库前，检查并补全缺失的 `visible` 对象，确保数据库内的数据格式统一。

### 完善数据模板
*   **修改 [Oort.json](file:///d:/Education/Project/Faramita%20Worlds/src/world_template/Oort.json)**：为 `setting-201`、`setting-301`、`setting-302` 等条目补全 `visible` 字段，从源头上解决数据不一致问题。

## 2. 具体操作计划

1.  **代码防御**：立即更新 `EntityViewer.vue` 的 computed 属性，使用 `c.visible?.public_visible` 这种安全写法。
2.  **数据补全**：更新 `Oort.json` 模板文件。
3.  **导入增强**：更新 `importer.ts`，使其能够自动处理旧数据或格式不全的数据。
4.  **清理验证**：建议您在修复后，通过控制台或删除 IndexedDB 重新触发导入，以加载最完整的数据。

**确认后，我将立即开始修复。**